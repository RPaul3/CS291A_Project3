(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{54:function(e,t,a){e.exports=a(65)},59:function(e,t,a){},60:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(9),o=a.n(r),c=(a(59),a(27)),u=a(28),i=a(32),l=a(29),d=a(12),h=a(33),m=(a(60),a(31)),p=a(98),g=a(103),v=a(36),f=a(104),b=a(105),w=a(106),S=a(109),E=a(107),O=a(108),y=a(41);function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(a,!0).forEach((function(t){Object(y.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var j=s.a.createContext({msg:[],user:[],addMsg:function(){},addUser:function(){},deleteUser:function(){},setToken:function(){},setShowCounter:function(){},messageCounterAdder:function(){},authToken:"",messageCounter:0,showCounter:!1});function k(e){var t={msg:[],user:[],addMsg:function(e){var t=r.msg;t.push(e),o(x({},r,{msg:t}))},addUser:function(e){var t=r.user;t.push(e),o(x({},r,{user:t}))},setToken:function(e){r.authToken=e},setShowCounter:function(){r.showCounter=!r.showCounter},deleteUser:function(e){var t=r.user,a=t.indexOf(e);-1!==a&&t.splice(a,1),o(x({},r,{user:t}))},messageCounterAdder:function(){r.messageCounter=r.messageCounter+1},authToken:"",messageCounter:0,showCounter:!1},a=s.a.useState(t),n=Object(m.a)(a,2),r=n[0],o=n[1];return s.a.createElement(j.Provider,{value:r},e.children)}var P=a(102),N=a(35),M=a(100),U=Object(p.a)({counter:{margin:10,color:"#fff",backgroundColor:N.a[800],position:"absolute",top:"110px",right:"500px"}});function J(){var e=s.a.useContext(j),t=U();return s.a.createElement(M.a,{container:!0},s.a.createElement(P.a,{className:t.counter},e.messageCounter))}var T=Object(p.a)((function(e){return{root:{margin:"100px",padding:e.spacing(3,2)},flex:{display:"flex",alignItems:"center"},userWindow:{width:"30%",height:"500px",borderRight:"1px solid black",overflowY:"scroll"},chatWindow:{width:"70%",height:"500px",padding:"30px",overflowY:"scroll"},chatBox:{width:"85%"},button:{width:"15%"}}}));function D(){var e=T(),t=s.a.useContext(j),a=s.a.useState(""),n=Object(m.a)(a,2),r=n[0],o=n[1];return s.a.createElement("div",null,s.a.createElement(g.a,{className:e.root},s.a.createElement(v.a,{variant:"h5",component:"h3"},"Chat App"),s.a.createElement(v.a,{component:"p"},"CS291A"),t.showCounter?s.a.createElement(J,null):null,s.a.createElement("div",{className:e.flex},s.a.createElement("div",{className:e.userWindow},s.a.createElement(f.a,null,t.user.map((function(e){return s.a.createElement(b.a,{key:e,button:!0},s.a.createElement(w.a,{primary:e}))})))),s.a.createElement("div",{className:e.chatWindow},t.msg.map((function(t,a){return s.a.createElement("div",{className:e.flex,key:a},s.a.createElement(S.a,{label:t.user,className:e.chip}),s.a.createElement(v.a,{component:"p"},t.created," ",t.event," ",t.user," ",t.message," ",t.status," "))})))),s.a.createElement(O.a,{label:"send a message",className:e.chatBox,value:r,onChange:function(e){return o(e.target.value)}}),s.a.createElement(E.a,{variant:"contained",color:"primary",className:e.button,onClick:function(){!function(e,t){var a=new XMLHttpRequest;a.open("POST","http://localhost:4567/message",!0);var n=new FormData;n.append("message",e),a.setRequestHeader("Authorization","Bearer ".concat(t)),a.onreadystatechange=function(){4===a.readyState&&201===a.status&&console.log("Message sent:"+e)},a.send(n)}(r,t.authToken),o("")}},"Send")))}var L=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(l.a)(t).call(this,e))).state={username:"",password:"",showPopup:!0},a.handleChangeUsername=a.handleChangeUsername.bind(Object(d.a)(a)),a.handleChangePassword=a.handleChangePassword.bind(Object(d.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(d.a)(a)),a.startEventSource=a.startEventSource.bind(Object(d.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"startEventSource",value:function(e){var t=this;console.log("eventSource started"),this.eventSource=new EventSource("http://localhost:4567/stream/".concat(e));this.context.msg;var a=this.context.addMsg,n=this.context.addUser,s=this.context.deleteUser,r=this.context.messageCounterAdder,o=this.context.setShowCounter;this.eventSource.addEventListener("Disconnect",(function(e){var n=JSON.parse(e.data);a({event:"Disconnect",created:"".concat(n.created),user:"",users:"",message:"",status:""}),console.log("Disconnect"),t.eventSource.close(),o();for(var r=t.context.user,c=0;c<r.length;c++)s(r[c]);t.props.handleSubmit()})),this.eventSource.addEventListener("Message",(function(e){console.log("Message listener triggered");var t=JSON.parse(e.data);r(),a({event:"Message",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"".concat(t.message),status:""}),console.log("Message from: "+t.user+" with "+t.message)})),this.eventSource.addEventListener("Join",(function(e){var t=JSON.parse(e.data);a({event:"Join",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"",status:""}),n(t.user),console.log("Join")})),this.eventSource.addEventListener("Part",(function(e){var t=JSON.parse(e.data);a({event:"Part",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"",status:""}),s(t.user),console.log("Part")})),this.eventSource.addEventListener("ServerStatus",(function(e){var t=JSON.parse(e.data);a({event:"ServerStatus",created:"".concat(t.created),user:"",users:"",message:"",status:"server started"}),console.log("ServerStatus")})),this.eventSource.addEventListener("Users",(function(e){for(var t=JSON.parse(e.data),s=t.users,r=0;r<s.length;r++)n(s[r]);a({event:"Users",created:"".concat(t.created),user:"",users:"jsonData.users",message:"",status:""}),console.log("Users")}))}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var a=new XMLHttpRequest,n=new FormData;n.append("username",this.state.username),n.append("password",this.state.password),a.open("POST","http://localhost:4567/login",!0),a.onreadystatechange=function(){if(4===a.readyState&&201===a.status){var e=t.context.setToken,n=t.context.setShowCounter,s=JSON.parse(a.responseText);t.startEventSource(s.token),e(s.token),n()}},a.send(n),this.props.handleSubmit()}},{key:"render",value:function(){return s.a.createElement("div",{style:{position:"fixed",width:"100%",height:"100%",top:"0",left:"0",right:"0",bottom:"0",margin:"auto",backgroundColor:"grey"},className:"popup"},s.a.createElement("div",{style:{position:"absolute",left:"25%",right:"25%",top:"25%",bottom:"25%",margin:"auto",borderRadius:"20px",background:"white"},className:"popupInner"},s.a.createElement("h1",null,this.props.text),s.a.createElement("form",{onSubmit:this.handleSubmit},"username:",s.a.createElement("input",{type:"text",name:"username",onChange:this.handleChangeUsername}),s.a.createElement("br",null),"password:",s.a.createElement("input",{type:"text",name:"password",onChange:this.handleChangePassword}),s.a.createElement("br",null),s.a.createElement("input",{type:"submit",value:"Submit"}))))}}]),t}(s.a.Component);L.contextType=j;var A=L,W=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(l.a)(t).call(this,e))).sendMessage=function(e){console.log("sendMessage",e)},a.state={showPopup:!0,history:[],users:[]},a.sendMessage=a.sendMessage.bind(Object(d.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleSubmit",value:function(){this.setState({showPopup:!this.state.showPopup})}},{key:"render",value:function(){return s.a.createElement(k,null,s.a.createElement("div",{className:"App"},this.state.showPopup?s.a.createElement(A,{text:"User Login",handleSubmit:this.handleSubmit.bind(this)}):null,s.a.createElement(D,null)))}}]),t}(n.Component);W.contextType=j;var B=W;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[54,1,2]]]);
//# sourceMappingURL=main.776a9b79.chunk.js.map