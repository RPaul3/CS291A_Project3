(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{54:function(e,t,n){e.exports=n(65)},59:function(e,t,n){},60:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(9),o=n.n(r),c=(n(59),n(27)),u=n(28),i=n(32),l=n(29),d=n(12),h=n(33),m=(n(60),n(31)),p=n(98),g=n(103),v=n(36),f=n(104),b=n(105),w=n(106),S=n(109),E=n(107),O=n(108),C=n(41);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){Object(C.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=s.a.createContext({msg:[],user:[],clearUsers:function(){},addMsg:function(){},addUser:function(){},deleteUser:function(){},setToken:function(){},setShowCounter:function(){},messageCounterAdder:function(){},authToken:"",messageCounter:0,showCounter:!1});function k(e){var t={msg:[],user:[],clearUsers:function(){console.log("before call user "+r.user.length),r.user=[],console.log("after call user "+r.user.length)},addMsg:function(e){var t=r.msg;t.push(e),o(y({},r,{msg:t}))},addUser:function(e){var t=r.user;t.push(e),o(y({},r,{user:t}))},setToken:function(e){r.authToken=e},setShowCounter:function(){console.log("before call stateCounter "+r.showCounter),r.showCounter=!r.showCounter,console.log("after call stateCounter "+r.showCounter)},deleteUser:function(e){var t=r.user,n=t.indexOf(e);-1!==n&&t.splice(n,1),o(y({},r,{user:t}))},messageCounterAdder:function(){r.messageCounter=r.messageCounter+1},authToken:"",messageCounter:0,showCounter:!1},n=s.a.useState(t),a=Object(m.a)(n,2),r=a[0],o=a[1];return s.a.createElement(j.Provider,{value:r},e.children)}var P=n(102),N=n(35),U=n(100),M=Object(p.a)({counter:{margin:10,color:"#fff",backgroundColor:N.a[800],position:"absolute",top:"110px",right:"500px"}});function J(){var e=s.a.useContext(j),t=M();return s.a.createElement(U.a,{container:!0},s.a.createElement(P.a,{className:t.counter},e.messageCounter))}var T=Object(p.a)((function(e){return{root:{margin:"100px",padding:e.spacing(3,2)},flex:{display:"flex",alignItems:"center"},userWindow:{width:"30%",height:"500px",borderRight:"1px solid black",overflowY:"scroll"},chatWindow:{width:"70%",height:"500px",padding:"30px",overflowY:"scroll"},chatBox:{width:"85%"},button:{width:"15%"}}}));function D(){var e=T(),t=s.a.useContext(j),n=s.a.useState(""),a=Object(m.a)(n,2),r=a[0],o=a[1];return s.a.createElement("div",null,s.a.createElement(g.a,{className:e.root},s.a.createElement(v.a,{variant:"h5",component:"h3"},"Chat App"),s.a.createElement(v.a,{component:"p"},"CS291A"),t.showCounter?s.a.createElement(J,null):null,s.a.createElement("div",{className:e.flex},s.a.createElement("div",{className:e.userWindow},"Online",s.a.createElement(f.a,null,t.user.map((function(e){return s.a.createElement(b.a,{key:e,button:!0},s.a.createElement(w.a,{primary:e}))})))),s.a.createElement("div",{className:e.chatWindow},t.msg.map((function(t,n){return s.a.createElement("div",{className:e.flex,key:n},s.a.createElement(S.a,{label:t.user,className:e.chip}),s.a.createElement(v.a,{component:"p"},t.created," ",t.event," ",t.user," ",t.message," ",t.status," "))})))),s.a.createElement(O.a,{label:"send a message",className:e.chatBox,value:r,onChange:function(e){return o(e.target.value)}}),s.a.createElement(E.a,{variant:"contained",color:"primary",className:e.button,onClick:function(){!function(e,t){var n=new XMLHttpRequest;n.open("POST","http://localhost:4567/message",!0);var a=new FormData;a.append("message",e),n.setRequestHeader("Authorization","Bearer ".concat(t)),n.onreadystatechange=function(){4===n.readyState&&201===n.status&&console.log("Message sent:"+e)},n.send(a)}(r,t.authToken),o("")}},"Send")))}var L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).state={username:"",password:"",showPopup:!0},n.handleChangeUsername=n.handleChangeUsername.bind(Object(d.a)(n)),n.handleChangePassword=n.handleChangePassword.bind(Object(d.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(d.a)(n)),n.startEventSource=n.startEventSource.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"startEventSource",value:function(e){var t=this;console.log("eventSource started"),this.eventSource=new EventSource("http://localhost:4567/stream/".concat(e));this.context.msg;var n=this.context.addMsg,a=this.context.addUser,s=this.context.deleteUser,r=this.context.setShowCounter,o=this.context.messageCounterAdder,c=this.context.clearUsers;this.eventSource.addEventListener("Disconnect",(function(e){var a=JSON.parse(e.data);n({event:"Disconnect",created:"".concat(a.created),user:"",users:"",message:"",status:""}),console.log("Disconnect"),t.eventSource.close(),c(),console.log("curr u are "+t.context.user.length),console.log("show is before "+t.context.showCounter),r(),console.log("show is after "+t.context.showCounter),t.props.handleSubmit()})),this.eventSource.addEventListener("Message",(function(e){var t=JSON.parse(e.data);n({event:"Message",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"".concat(t.message),status:""}),o(),console.log("Message from: "+t.user)})),this.eventSource.addEventListener("Join",(function(e){var t=JSON.parse(e.data);n({event:"Join",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"",status:""}),a(t.user),console.log("Join")})),this.eventSource.addEventListener("Part",(function(e){var t=JSON.parse(e.data);n({event:"Part",created:"".concat(t.created),user:"".concat(t.user),users:"",message:"",status:""}),s(t.user),console.log("Part")})),this.eventSource.addEventListener("ServerStatus",(function(e){var t=JSON.parse(e.data);n({event:"ServerStatus",created:"".concat(t.created),user:"",users:"",message:"",status:"server started"}),console.log("ServerStatus")})),this.eventSource.addEventListener("Users",(function(e){var t=JSON.parse(e.data);n({event:"Users",created:"".concat(t.created),user:"",users:"jsonData.users",message:"",status:""});for(var s=t.users,r=0;r<s.length;r++)console.log("add "+r),a(s[r]);console.log("Users")}))}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this,n=this.context.setShowCounter;e.preventDefault();var a=new XMLHttpRequest,s=new FormData;s.append("username",this.state.username),s.append("password",this.state.password),a.open("POST","http://localhost:4567/login",!0),a.onreadystatechange=function(e){if(4===a.readyState&&201===a.status){var s=t.context.setToken,r=JSON.parse(a.responseText);t.startEventSource(r.token),s(r.token),n()}},a.send(s),this.props.handleSubmit()}},{key:"render",value:function(){return s.a.createElement("div",{style:{position:"fixed",width:"100%",height:"100%",top:"0",left:"0",right:"0",bottom:"0",margin:"auto",backgroundColor:"grey"},className:"popup"},s.a.createElement("div",{style:{position:"absolute",left:"25%",right:"25%",top:"25%",bottom:"25%",margin:"auto",borderRadius:"20px",background:"white"},className:"popupInner"},s.a.createElement("h1",null,this.props.text),s.a.createElement("form",{onSubmit:this.handleSubmit},"username:",s.a.createElement("input",{type:"text",name:"username",onChange:this.handleChangeUsername}),s.a.createElement("br",null),"password:",s.a.createElement("input",{type:"text",name:"password",onChange:this.handleChangePassword}),s.a.createElement("br",null),s.a.createElement("input",{type:"submit",value:"Submit"}))))}}]),t}(s.a.Component);L.contextType=j;var A=L,W=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).sendMessage=function(e){console.log("sendMessage",e)},n.state={showPopup:!0,history:[],users:[]},n.sendMessage=n.sendMessage.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleSubmit",value:function(){this.setState({showPopup:!this.state.showPopup})}},{key:"render",value:function(){return s.a.createElement(k,null,s.a.createElement("div",{className:"App"},this.state.showPopup?s.a.createElement(A,{text:"User Login",handleSubmit:this.handleSubmit.bind(this)}):null,s.a.createElement(D,null)))}}]),t}(a.Component);W.contextType=j;var B=W;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[54,1,2]]]);
//# sourceMappingURL=main.a1492a0c.chunk.js.map